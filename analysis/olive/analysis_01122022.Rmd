---
title: "Olive analysis"
output:
  html_document:
    toc: yes
    toc_float: yes
---

# Loading libraries

```{r}

library(readxl)
library(ggplot2)

```

# Looking at sample metadata

```{r}

manifest <- read_excel("/media/theron/My_Passport/KenOlive_CUMC_LCM_RNASeq_SJout/HLA_genotypes_CUMC_LCMRNASeq/Interactome-Cases-2021-01-31.xlsx")

ggplot(manifest,aes(x=Compartment,fill=Type))+
  geom_bar()+
  geom_text(stat="count",aes(label=..count..),position=position_stack(vjust = 0.5))

```
# Creating Comparisons

1. Epi_IPMN vs Epi_PanIN
2. Epi_IPMN vs Epi_Primary
3. Epi_PanIN vs Epi_Primary
4. Stroma_IPMN vs Stroma_PanIN
5. Stroma_IPMN vs Stroma_Primary
6. Stroma_PanIN vs Stroma_Primary
7. Epi_IPMN vs Stroma_IPMN
8. Epi_IPMN vs Stroma_PanIN
9. Epi_IPMN vs Stroma_Primary
10. Epi_PanIN vs Stroma_IPMN
11. Epi_PanIN vs Stroma_PanIN
12. Epi_PanIN vs Stroma_Primary
13. Epi_Primary vs Stroma_IPMN
14. Epi_Primary vs Stroma_PanIN
15. Epi_Primary vs Stroma_Primary

## Comparison output directory

```{r}

out_dir<-"/media/theron/My_Passport/KenOlive_CUMC_LCM_RNASeq_SJout/comparisons"
if(!dir.exists(out_dir)){
  dir.create(out_dir)
}
junc_dir <- "/users/tpalmer/olive/SJout/juncs"

```


## Epi_IPMN vs Epi_PanIN

```{r}

comp_1<-"Epithelium"
comp_2<-"IPMN"
comp_3<-"Epithelium"
comp_4<-"PanIN"
groups_file_name <- sprintf("%s/groups_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
manifest_1<-manifest %>% dplyr::filter(Compartment==comp_1 & Type==comp_2)
manifest_2<-manifest %>% dplyr::filter(Compartment==comp_3 & Type==comp_4)
groups_file <- rbind(manifest_1,manifest_2)
groups_file$label<-sprintf("%s_%s",groups_file$Compartment,groups_file$Type)
groups_file <- groups_file[,c("CUMC_SampleID","label")]
groups_file$CUMC_SampleID <- sprintf("%s.filt",groups_file$CUMC_SampleID)
write.table(groups_file,file=groups_file_name,col.names=F,row.names=F,sep="\t",quote=F)
junc_file <- groups_file[,"CUMC_SampleID",drop=F]
junc_file$CUMC_SampleID <- sprintf("%s/%s.junc",junc_dir,junc_file$CUMC_SampleID)
junc_file_name <- sprintf("%s/junc_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
write.table(junc_file,file=junc_file_name,col.names=F,row.names=F,sep="\t",quote=F)
  
```

## Epi_IPMN vs Epi_Primary

```{r}

comp_1<-"Epithelium"
comp_2<-"IPMN"
comp_3<-"Epithelium"
comp_4<-"Primary"
groups_file_name <- sprintf("%s/groups_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
manifest_1<-manifest %>% dplyr::filter(Compartment==comp_1 & Type==comp_2)
manifest_2<-manifest %>% dplyr::filter(Compartment==comp_3 & Type==comp_4)
groups_file <- rbind(manifest_1,manifest_2)
groups_file$label<-sprintf("%s_%s",groups_file$Compartment,groups_file$Type)
groups_file <- groups_file[,c("CUMC_SampleID","label")]
groups_file$CUMC_SampleID <- sprintf("%s.filt",groups_file$CUMC_SampleID)
write.table(groups_file,file=groups_file_name,col.names=F,row.names=F,sep="\t",quote=F)
junc_file <- groups_file[,"CUMC_SampleID",drop=F]
junc_file$CUMC_SampleID <- sprintf("%s/%s.junc",junc_dir,junc_file$CUMC_SampleID)
junc_file_name <- sprintf("%s/junc_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
write.table(junc_file,file=junc_file_name,col.names=F,row.names=F,sep="\t",quote=F)

```



## Epi_PanIN vs Epi_Primary

```{r}

comp_1<-"Epithelium"
comp_2<-"PanIN"
comp_3<-"Epithelium"
comp_4<-"Primary"
groups_file_name <- sprintf("%s/groups_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
manifest_1<-manifest %>% dplyr::filter(Compartment==comp_1 & Type==comp_2)
manifest_2<-manifest %>% dplyr::filter(Compartment==comp_3 & Type==comp_4)
groups_file <- rbind(manifest_1,manifest_2)
groups_file$label<-sprintf("%s_%s",groups_file$Compartment,groups_file$Type)
groups_file <- groups_file[,c("CUMC_SampleID","label")]
groups_file$CUMC_SampleID <- sprintf("%s.filt",groups_file$CUMC_SampleID)
write.table(groups_file,file=groups_file_name,col.names=F,row.names=F,sep="\t",quote=F)
junc_file <- groups_file[,"CUMC_SampleID",drop=F]
junc_file$CUMC_SampleID <- sprintf("%s/%s.junc",junc_dir,junc_file$CUMC_SampleID)
junc_file_name <- sprintf("%s/junc_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
write.table(junc_file,file=junc_file_name,col.names=F,row.names=F,sep="\t",quote=F)

```

## Stroma_IPMN vs Stroma_PanIN
```{r}

comp_1<-"Stroma"
comp_2<-"IPMN"
comp_3<-"Stroma"
comp_4<-"PanIN"
groups_file_name <- sprintf("%s/groups_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
manifest_1<-manifest %>% dplyr::filter(Compartment==comp_1 & Type==comp_2)
manifest_2<-manifest %>% dplyr::filter(Compartment==comp_3 & Type==comp_4)
groups_file <- rbind(manifest_1,manifest_2)
groups_file$label<-sprintf("%s_%s",groups_file$Compartment,groups_file$Type)
groups_file <- groups_file[,c("CUMC_SampleID","label")]
groups_file$CUMC_SampleID <- sprintf("%s.filt",groups_file$CUMC_SampleID)
write.table(groups_file,file=groups_file_name,col.names=F,row.names=F,sep="\t",quote=F)
junc_file <- groups_file[,"CUMC_SampleID",drop=F]
junc_file$CUMC_SampleID <- sprintf("%s/%s.junc",junc_dir,junc_file$CUMC_SampleID)
junc_file_name <- sprintf("%s/junc_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
write.table(junc_file,file=junc_file_name,col.names=F,row.names=F,sep="\t",quote=F)
```

## Stroma_IPMN vs Stroma_Primary
```{r}

comp_1<-"Stroma"
comp_2<-"IPMN"
comp_3<-"Stroma"
comp_4<-"Primary"
groups_file_name <- sprintf("%s/groups_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
manifest_1<-manifest %>% dplyr::filter(Compartment==comp_1 & Type==comp_2)
manifest_2<-manifest %>% dplyr::filter(Compartment==comp_3 & Type==comp_4)
groups_file <- rbind(manifest_1,manifest_2)
groups_file$label<-sprintf("%s_%s",groups_file$Compartment,groups_file$Type)
groups_file <- groups_file[,c("CUMC_SampleID","label")]
groups_file$CUMC_SampleID <- sprintf("%s.filt",groups_file$CUMC_SampleID)
write.table(groups_file,file=groups_file_name,col.names=F,row.names=F,sep="\t",quote=F)
junc_file <- groups_file[,"CUMC_SampleID",drop=F]
junc_file$CUMC_SampleID <- sprintf("%s/%s.junc",junc_dir,junc_file$CUMC_SampleID)
junc_file_name <- sprintf("%s/junc_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
write.table(junc_file,file=junc_file_name,col.names=F,row.names=F,sep="\t",quote=F)

```

## Stroma_PanIN vs Stroma_Primary
```{r}

comp_1<-"Stroma"
comp_2<-"PanIN"
comp_3<-"Stroma"
comp_4<-"Primary"
groups_file_name <- sprintf("%s/groups_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
manifest_1<-manifest %>% dplyr::filter(Compartment==comp_1 & Type==comp_2)
manifest_2<-manifest %>% dplyr::filter(Compartment==comp_3 & Type==comp_4)
groups_file <- rbind(manifest_1,manifest_2)
groups_file$label<-sprintf("%s_%s",groups_file$Compartment,groups_file$Type)
groups_file <- groups_file[,c("CUMC_SampleID","label")]
groups_file$CUMC_SampleID <- sprintf("%s.filt",groups_file$CUMC_SampleID)
write.table(groups_file,file=groups_file_name,col.names=F,row.names=F,sep="\t",quote=F)
junc_file <- groups_file[,"CUMC_SampleID",drop=F]
junc_file$CUMC_SampleID <- sprintf("%s/%s.junc",junc_dir,junc_file$CUMC_SampleID)
junc_file_name <- sprintf("%s/junc_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
write.table(junc_file,file=junc_file_name,col.names=F,row.names=F,sep="\t",quote=F)

```

## Epi_IPMN vs Stroma_IPMN
```{r}

comp_1<-"Epithelium"
comp_2<-"IPMN"
comp_3<-"Stroma"
comp_4<-"IPMN"
groups_file_name <- sprintf("%s/groups_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
manifest_1<-manifest %>% dplyr::filter(Compartment==comp_1 & Type==comp_2)
manifest_2<-manifest %>% dplyr::filter(Compartment==comp_3 & Type==comp_4)
groups_file <- rbind(manifest_1,manifest_2)
groups_file$label<-sprintf("%s_%s",groups_file$Compartment,groups_file$Type)
groups_file <- groups_file[,c("CUMC_SampleID","label")]
groups_file$CUMC_SampleID <- sprintf("%s.filt",groups_file$CUMC_SampleID)
write.table(groups_file,file=groups_file_name,col.names=F,row.names=F,sep="\t",quote=F)
junc_file <- groups_file[,"CUMC_SampleID",drop=F]
junc_file$CUMC_SampleID <- sprintf("%s/%s.junc",junc_dir,junc_file$CUMC_SampleID)
junc_file_name <- sprintf("%s/junc_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
write.table(junc_file,file=junc_file_name,col.names=F,row.names=F,sep="\t",quote=F)

```

## Epi_IPMN vs Stroma_PanIN
```{r}

comp_1<-"Epithelium"
comp_2<-"IPMN"
comp_3<-"Stroma"
comp_4<-"PanIN"
groups_file_name <- sprintf("%s/groups_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
manifest_1<-manifest %>% dplyr::filter(Compartment==comp_1 & Type==comp_2)
manifest_2<-manifest %>% dplyr::filter(Compartment==comp_3 & Type==comp_4)
groups_file <- rbind(manifest_1,manifest_2)
groups_file$label<-sprintf("%s_%s",groups_file$Compartment,groups_file$Type)
groups_file <- groups_file[,c("CUMC_SampleID","label")]
groups_file$CUMC_SampleID <- sprintf("%s.filt",groups_file$CUMC_SampleID)
write.table(groups_file,file=groups_file_name,col.names=F,row.names=F,sep="\t",quote=F)
junc_file <- groups_file[,"CUMC_SampleID",drop=F]
junc_file$CUMC_SampleID <- sprintf("%s/%s.junc",junc_dir,junc_file$CUMC_SampleID)
junc_file_name <- sprintf("%s/junc_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
write.table(junc_file,file=junc_file_name,col.names=F,row.names=F,sep="\t",quote=F)

```

## Epi_IPMN vs Stroma_Primary
```{r}

comp_1<-"Epithelium"
comp_2<-"IPMN"
comp_3<-"Stroma"
comp_4<-"Primary"
groups_file_name <- sprintf("%s/groups_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
manifest_1<-manifest %>% dplyr::filter(Compartment==comp_1 & Type==comp_2)
manifest_2<-manifest %>% dplyr::filter(Compartment==comp_3 & Type==comp_4)
groups_file <- rbind(manifest_1,manifest_2)
groups_file$label<-sprintf("%s_%s",groups_file$Compartment,groups_file$Type)
groups_file <- groups_file[,c("CUMC_SampleID","label")]
groups_file$CUMC_SampleID <- sprintf("%s.filt",groups_file$CUMC_SampleID)
write.table(groups_file,file=groups_file_name,col.names=F,row.names=F,sep="\t",quote=F)
junc_file <- groups_file[,"CUMC_SampleID",drop=F]
junc_file$CUMC_SampleID <- sprintf("%s/%s.junc",junc_dir,junc_file$CUMC_SampleID)
junc_file_name <- sprintf("%s/junc_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
write.table(junc_file,file=junc_file_name,col.names=F,row.names=F,sep="\t",quote=F)

```

## Epi_PanIN vs Stroma_IPMN
```{r}

comp_1<-"Epithelium"
comp_2<-"PanIN"
comp_3<-"Stroma"
comp_4<-"IPMN"
groups_file_name <- sprintf("%s/groups_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
manifest_1<-manifest %>% dplyr::filter(Compartment==comp_1 & Type==comp_2)
manifest_2<-manifest %>% dplyr::filter(Compartment==comp_3 & Type==comp_4)
groups_file <- rbind(manifest_1,manifest_2)
groups_file$label<-sprintf("%s_%s",groups_file$Compartment,groups_file$Type)
groups_file <- groups_file[,c("CUMC_SampleID","label")]
groups_file$CUMC_SampleID <- sprintf("%s.filt",groups_file$CUMC_SampleID)
write.table(groups_file,file=groups_file_name,col.names=F,row.names=F,sep="\t",quote=F)
junc_file <- groups_file[,"CUMC_SampleID",drop=F]
junc_file$CUMC_SampleID <- sprintf("%s/%s.junc",junc_dir,junc_file$CUMC_SampleID)
junc_file_name <- sprintf("%s/junc_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
write.table(junc_file,file=junc_file_name,col.names=F,row.names=F,sep="\t",quote=F)

```

## Epi_PanIN vs Stroma_PanIN
```{r}

comp_1<-"Epithelium"
comp_2<-"PanIN"
comp_3<-"Stroma"
comp_4<-"PanIN"
groups_file_name <- sprintf("%s/groups_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
manifest_1<-manifest %>% dplyr::filter(Compartment==comp_1 & Type==comp_2)
manifest_2<-manifest %>% dplyr::filter(Compartment==comp_3 & Type==comp_4)
groups_file <- rbind(manifest_1,manifest_2)
groups_file$label<-sprintf("%s_%s",groups_file$Compartment,groups_file$Type)
groups_file <- groups_file[,c("CUMC_SampleID","label")]
groups_file$CUMC_SampleID <- sprintf("%s.filt",groups_file$CUMC_SampleID)
write.table(groups_file,file=groups_file_name,col.names=F,row.names=F,sep="\t",quote=F)
junc_file <- groups_file[,"CUMC_SampleID",drop=F]
junc_file$CUMC_SampleID <- sprintf("%s/%s.junc",junc_dir,junc_file$CUMC_SampleID)
junc_file_name <- sprintf("%s/junc_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
write.table(junc_file,file=junc_file_name,col.names=F,row.names=F,sep="\t",quote=F)

```

## Epi_PanIN vs Stroma_Primary
```{r}

comp_1<-"Epithelium"
comp_2<-"PanIN"
comp_3<-"Stroma"
comp_4<-"Primary"
groups_file_name <- sprintf("%s/groups_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
manifest_1<-manifest %>% dplyr::filter(Compartment==comp_1 & Type==comp_2)
manifest_2<-manifest %>% dplyr::filter(Compartment==comp_3 & Type==comp_4)
groups_file <- rbind(manifest_1,manifest_2)
groups_file$label<-sprintf("%s_%s",groups_file$Compartment,groups_file$Type)
groups_file <- groups_file[,c("CUMC_SampleID","label")]
groups_file$CUMC_SampleID <- sprintf("%s.filt",groups_file$CUMC_SampleID)
write.table(groups_file,file=groups_file_name,col.names=F,row.names=F,sep="\t",quote=F)
junc_file <- groups_file[,"CUMC_SampleID",drop=F]
junc_file$CUMC_SampleID <- sprintf("%s/%s.junc",junc_dir,junc_file$CUMC_SampleID)
junc_file_name <- sprintf("%s/junc_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
write.table(junc_file,file=junc_file_name,col.names=F,row.names=F,sep="\t",quote=F)

```

## Epi_Primary vs Stroma_IPMN
```{r}

comp_1<-"Epithelium"
comp_2<-"Primary"
comp_3<-"Stroma"
comp_4<-"IPMN"
groups_file_name <- sprintf("%s/groups_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
manifest_1<-manifest %>% dplyr::filter(Compartment==comp_1 & Type==comp_2)
manifest_2<-manifest %>% dplyr::filter(Compartment==comp_3 & Type==comp_4)
groups_file <- rbind(manifest_1,manifest_2)
groups_file$label<-sprintf("%s_%s",groups_file$Compartment,groups_file$Type)
groups_file <- groups_file[,c("CUMC_SampleID","label")]
groups_file$CUMC_SampleID <- sprintf("%s.filt",groups_file$CUMC_SampleID)
write.table(groups_file,file=groups_file_name,col.names=F,row.names=F,sep="\t",quote=F)
junc_file <- groups_file[,"CUMC_SampleID",drop=F]
junc_file$CUMC_SampleID <- sprintf("%s/%s.junc",junc_dir,junc_file$CUMC_SampleID)
junc_file_name <- sprintf("%s/junc_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
write.table(junc_file,file=junc_file_name,col.names=F,row.names=F,sep="\t",quote=F)

```

## Epi_Primary vs Stroma_PanIN
```{r}

comp_1<-"Epithelium"
comp_2<-"Primary"
comp_3<-"Stroma"
comp_4<-"PanIN"
groups_file_name <- sprintf("%s/groups_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
manifest_1<-manifest %>% dplyr::filter(Compartment==comp_1 & Type==comp_2)
manifest_2<-manifest %>% dplyr::filter(Compartment==comp_3 & Type==comp_4)
groups_file <- rbind(manifest_1,manifest_2)
groups_file$label<-sprintf("%s_%s",groups_file$Compartment,groups_file$Type)
groups_file <- groups_file[,c("CUMC_SampleID","label")]
groups_file$CUMC_SampleID <- sprintf("%s.filt",groups_file$CUMC_SampleID)
write.table(groups_file,file=groups_file_name,col.names=F,row.names=F,sep="\t",quote=F)
junc_file <- groups_file[,"CUMC_SampleID",drop=F]
junc_file$CUMC_SampleID <- sprintf("%s/%s.junc",junc_dir,junc_file$CUMC_SampleID)
junc_file_name <- sprintf("%s/junc_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
write.table(junc_file,file=junc_file_name,col.names=F,row.names=F,sep="\t",quote=F)

```

## Epi_Primary vs Stroma_Primary
```{r}

comp_1<-"Epithelium"
comp_2<-"Primary"
comp_3<-"Stroma"
comp_4<-"Primary"
groups_file_name <- sprintf("%s/groups_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
manifest_1<-manifest %>% dplyr::filter(Compartment==comp_1 & Type==comp_2)
manifest_2<-manifest %>% dplyr::filter(Compartment==comp_3 & Type==comp_4)
groups_file <- rbind(manifest_1,manifest_2)
groups_file$label<-sprintf("%s_%s",groups_file$Compartment,groups_file$Type)
groups_file <- groups_file[,c("CUMC_SampleID","label")]
groups_file$CUMC_SampleID <- sprintf("%s.filt",groups_file$CUMC_SampleID)
write.table(groups_file,file=groups_file_name,col.names=F,row.names=F,sep="\t",quote=F)
junc_file <- groups_file[,"CUMC_SampleID",drop=F]
junc_file$CUMC_SampleID <- sprintf("%s/%s.junc",junc_dir,junc_file$CUMC_SampleID)
junc_file_name <- sprintf("%s/junc_file_%s_%s_%s_%s.txt",out_dir,comp_1,comp_2,comp_3,comp_4)
write.table(junc_file,file=junc_file_name,col.names=F,row.names=F,sep="\t",quote=F)

```
